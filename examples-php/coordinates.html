<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>AstronomyLibs::Coordinates Examples (PHP)</title>
<link rel="stylesheet" href="../css/styles.css">
<link rel="shortcut icon" href="../favicon/moon.png">
<style>
#decimals {
    width: 50px;
}
</style>
</head>
<body>
<form>
    <table>
        <thead>
            <tr>
                <td>Float Coordinate</td>
                <td>Text Coordinate</td>
                <td>Format</td>
                <td>Decimals</td>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><input type="text" id="floatcoordinates" autofocus oninput="updateFloat2Text()" placeholder="Float"></td>
                <td><input type="text" id="textcoordinates" oninput="updateText2Float()" placeholder="Text"></td>
                <td><select id="format" onchange="updateLastChanged()">
                        <option value="symbols" selected>10Â° 20' 30.4"</option>
                        <option value="spaces">10 20 30.4</option>
                        <option value="dms">10d 20m 30.4s</option>
                        <option value="hms">10h 20m 30.4s</option>
                    </select>
                </td>
                <td><input type="number" id="decimals" value="" oninput="updateLastChanged()"></td>
            </tr>
        </tbody>
    </table>
</form>
<script>
// set input fields
var floatcoordinates = document.getElementById('floatcoordinates');
var textcoordinates  = document.getElementById('textcoordinates');
var format           = document.getElementById('format');
var decimals         = document.getElementById('decimals');

// set variable which of float or text field was updated last
var last_updated = null;

function updateFloat2Text() {
    last_updated = "f2t";

    xmlhttp = new XMLHttpRequest();
    xmlhttp.open("POST", "coordinates.ajax.php", true);
    xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");
    xmlhttp.send("float2text=" + floatcoordinates.value + "&format=" + format.value + "&decimals=" + decimals.value);
    xmlhttp.onreadystatechange = function() {
        if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
            textcoordinates.value = xmlhttp.responseText;
        } else {
            textcoordinates.innerHTML = "invalid";
        }
    }
}

function updateText2Float() {
    last_updated = "t2f";

    xmlhttp = new XMLHttpRequest();
    xmlhttp.open("POST", "coordinates.ajax.php", true);
    xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");
    xmlhttp.send("text2float=" + textcoordinates.value + "&decimals=" + decimals.value);
    xmlhttp.onreadystatechange = function() {
        if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
            floatcoordinates.value = xmlhttp.responseText;
        } else {
            floatcoordinates.innerHTML = "invalid";
        }
    }
}

/* if format or decimals are changed, update either
   float or text input field depending on which was
   last updated */
function updateLastChanged() {
    if (last_updated == "f2t") {
        updateFloat2Text();
    } else if (last_updated == "t2f") {
        updateText2Float();
    }
}
</script>
</body>
</html>